# プロダクションデプロイメントチェックリスト

このチェックリストはv1z3r VJアプリケーションのプロダクション環境への安全なデプロイメントを確保するためのものです。

## デプロイ前チェックリスト

### 📋 コード品質
- [ ] **TypeScript型チェック**: `yarn type-check` が成功している
- [ ] **ESLint**: `yarn lint` でエラーなし
- [ ] **テスト成功率**: 90%以上のテスト成功率を確認
- [ ] **ビルド成功**: `yarn build` が正常に完了
- [ ] **モジュールビルド**: `yarn build:modules` が正常に完了

### 🔒 セキュリティ
- [ ] **依存関係スキャン**: 脆弱性のある依存関係がないことを確認
- [ ] **秘密情報**: `.env`ファイルや認証情報がコミットされていないことを確認
- [ ] **CSPヘッダー**: Content Security Policyが適切に設定されている
- [ ] **HTTPS**: すべての外部APIがHTTPSで呼び出されている

### 🚀 パフォーマンス
- [ ] **バンドルサイズ**: 総バンドルサイズが許容範囲内（< 5MB）
- [ ] **画像最適化**: 画像ファイルが適切に圧縮・最適化されている
- [ ] **キャッシュ戦略**: 静的アセットのキャッシュが適切に設定されている
- [ ] **レンダリング最適化**: React.memoやuseMemoが適切に使用されている

### 🌐 ブラウザ互換性
- [ ] **Chrome**: 最新版での動作確認
- [ ] **Firefox**: 最新版での動作確認
- [ ] **Safari**: 最新版での動作確認
- [ ] **モバイル**: レスポンシブデザインの動作確認

### 📱 機能テスト
- [ ] **MIDI機能**: MIDI機器との接続・制御が正常動作
- [ ] **オーディオ機能**: マイクロフォン入力・音声解析が正常動作
- [ ] **ビジュアル機能**: WebGL/Three.jsエフェクトが正常描画
- [ ] **レイヤー管理**: レイヤーの追加・削除・編集が正常動作
- [ ] **プリセット機能**: プリセットの保存・読み込みが正常動作

## AWS インフラストラクチャチェックリスト

### ☁️ CDK デプロイメント
- [ ] **認証設定**: AWS CLIの認証情報が正しく設定されている
- [ ] **Bootstrap**: CDK bootstrapが実行済み
- [ ] **環境分離**: dev/staging/prodが適切に分離されている
- [ ] **リソース制限**: 適切なリソース制限が設定されている

### 🗄️ データストレージ
- [ ] **DynamoDB**: テーブルが適切に作成・設定されている
- [ ] **S3**: バケットのアクセス許可が適切に設定されている
- [ ] **バックアップ**: 定期バックアップが設定されている

### 🔐 IAMセキュリティ
- [ ] **最小権限**: 必要最小限の権限のみが付与されている
- [ ] **MFA**: 管理者アカウントでMFAが有効化されている
- [ ] **アクセスキー**: 不要なアクセスキーがローテーションされている

## CI/CD パイプラインチェックリスト

### 🔄 GitHub Actions
- [ ] **ワークフロー成功**: すべてのワークフローが成功している
- [ ] **ブランチ保護**: mainブランチに適切な保護ルールが設定されている
- [ ] **レビュー必須**: PRには必須レビューが設定されている
- [ ] **自動デプロイ**: mainブランチマージ時の自動デプロイが設定されている

### 📊 監視・ログ
- [ ] **CloudWatch**: ログとメトリクスが適切に収集されている
- [ ] **アラート**: 重要なメトリクスにアラートが設定されている
- [ ] **ヘルスチェック**: エンドポイントヘルスチェックが設定されている

## 本番環境デプロイ手順

### 1. 最終確認
```bash
# すべてのチェックを実行
./scripts/manual-ci-check.sh

# 依存関係の最終確認
yarn audit --audit-level moderate

# プロダクションビルドテスト
yarn build
```

### 2. インフラストラクチャデプロイ
```bash
# プロダクション環境にデプロイ
cd infra/cdk
cdk deploy --all --profile prod

# デプロイ状況確認
aws cloudformation describe-stacks --profile prod
```

### 3. アプリケーションデプロイ
```bash
# GitHub Actionsでのデプロイ確認
# または手動デプロイ
yarn build
aws s3 sync out/ s3://your-production-bucket --delete
```

### 4. デプロイ後確認
```bash
# ヘルスチェック
curl -f https://your-domain.com/api/health

# E2Eテスト実行
yarn test:e2e --config=playwright.config.prod.ts
```

## ロールバック手順

### 緊急時のロールバック
```bash
# 前のバージョンに戻す
git checkout [previous-commit-hash]
yarn build
aws s3 sync out/ s3://your-production-bucket --delete

# または CloudFormationスタックをロールバック
aws cloudformation cancel-update-stack --stack-name YourStackName
```

## 監視とアラート

### 📈 重要メトリクス
- [ ] **レスポンス時間**: < 2秒
- [ ] **エラー率**: < 1%
- [ ] **稼働率**: > 99.9%
- [ ] **メモリ使用量**: 適切な範囲内

### 🚨 アラート設定
- [ ] **サーバーエラー**: 5xx エラーが発生時
- [ ] **高レスポンス時間**: 応答時間が閾値を超過時
- [ ] **リソース使用量**: CPU/メモリが80%を超過時

## デプロイ後のタスク

### ✅ 即座に実行
- [ ] **機能確認**: 主要機能が正常動作することを確認
- [ ] **パフォーマンス確認**: ページ読み込み時間を確認
- [ ] **ログ確認**: エラーログがないことを確認

### ⏰ 24時間以内
- [ ] **メトリクス確認**: CloudWatchメトリクスを確認
- [ ] **ユーザーフィードバック**: 問題報告がないか確認
- [ ] **セキュリティスキャン**: 本番環境でのセキュリティスキャン実行

### 📅 1週間以内
- [ ] **パフォーマンス分析**: 詳細なパフォーマンス分析
- [ ] **コスト確認**: AWSコストが予算内であることを確認
- [ ] **バックアップ確認**: バックアップが正常に作成されていることを確認

## 緊急連絡先

- **開発チーム**: [連絡先]
- **インフラチーム**: [連絡先]
- **オンコール**: [連絡先]

## 関連ドキュメント

- [AWS認証設定ガイド](./AWS_AUTHENTICATION_SETUP.md)
- [GitHub Actions課金問題対応](./GITHUB_ACTIONS_BILLING_ISSUE.md)
- [デプロイメント検証レポート](./deployment-verification-report.md)

---

**注意**: このチェックリストは定期的に更新し、新しい要件や課題に対応してください。